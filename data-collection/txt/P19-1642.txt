



















































Latent Variable Model for Multi-modal Translation


Proceedings of the 57th Annual Meeting of the Association for Computational Linguistics, pages 6392–6405
Florence, Italy, July 28 - August 2, 2019. c©2019 Association for Computational Linguistics

6392

Latent Variable Model for Multi-modal Translation

Iacer Calixto Miguel Rios
ILLC

The University of Amsterdam
{iacer.calixto,m.riosgaona,w.aziz}@uva.nl

Wilker Aziz

Abstract

In this work, we propose to model the in-
teraction between visual and textual features
for multi-modal neural machine translation
(MMT) through a latent variable model. This
latent variable can be seen as a multi-modal
stochastic embedding of an image and its de-
scription in a foreign language. It is used
in a target-language decoder and also to pre-
dict image features. Importantly, our model
formulation utilises visual and textual inputs
during training but does not require that im-
ages be available at test time. We show
that our latent variable MMT formulation im-
proves considerably over strong baselines, in-
cluding a multi-task learning approach (Elliott
and Kádár, 2017) and a conditional variational
auto-encoder approach (Toyama et al., 2016).
Finally, we show improvements due to (i) pre-
dicting image features in addition to only con-
ditioning on them, (ii) imposing a constraint
on the KL term to promote models with non-
negligible mutual information between inputs
and latent variable, and (iii) by training on
additional target-language image descriptions
(i.e. synthetic data).

1 Introduction

Multi-modal machine translation (MMT) is an
exciting novel take on machine translation (MT)
where we are interested in learning to translate
sentences in the presence of visual input (mostly
images). In the last three years there have been
shared tasks (Specia et al., 2016; Elliott et al., 2017;
Barrault et al., 2018) where many research groups
proposed different techniques to integrate images
into MT, e.g. Caglayan et al. (2017); Libovický and
Helcl (2017).

Most MMT models expand neural machine trans-
lation (NMT) architectures (Sutskever et al., 2014;
Bahdanau et al., 2015) to additionally condition
on an image in order to compute the likelihood

of a translation in context. This gives the model
a chance to exploit correlations in visual and lan-
guage data, but also means that images must be
available at test time. An exception to this rule is
the work of Toyama et al. (2016) who exploit the
framework of conditional variational auto-encoders
(CVAEs) (Sohn et al., 2015) to decouple the en-
coder used for posterior inference at training time
from the encoder used for generation at test time.
Rather than conditioning on image features, the
model of Elliott and Kádár (2017) learns to rank
image features using language data in a multi-task
learning (MTL) framework, therefore sharing pa-
rameters between a translation (generative) and
a sentence-image ranking model (discriminative).
This similarly exploits correlations between the
two modalities and has the advantage that images
are also not necessary at test time.

In this work, we also aim at translating with-
out images at test time, yet learning a visually
grounded translation model. To that end, we re-
sort to probabilistic modelling instead of multi-task
learning and estimate a joint distribution over trans-
lations and images. In a nutshell, we propose to
model the interaction between visual and textual
features through a latent variable. This latent vari-
able can be seen as a stochastic embedding which
is used in the target-language decoder, as well as
to predict image features. Our experiments show
that this joint formulation improves over an MTL
approach (Elliott and Kádár, 2017), which does
model both modalities but not jointly, and over the
CVAE of Toyama et al. (2016), which uses image
features to condition an inference network but cru-
cially does not model the images.

The main contributions of this paper are:1

• we propose a novel multi-modal NMT model
1Code and pre-trained models available in https://

github.com/iacercalixto/variational_mmt.

https://github.com/iacercalixto/variational_mmt
https://github.com/iacercalixto/variational_mmt


6393

that incorporates image features through la-
tent variables in a deep generative model.

• our latent variable MMT formulation im-
proves considerably over strong baselines, and
compares favourably to the state-of-the-art.

• we exploit correlations between both modali-
ties at training time through a joint generative
approach and do not require images at predic-
tion time.

The remainder of this paper is organised as fol-
lows. In §2, we describe our variational MMT
models. In §3, we introduce the data sets we used
and report experiments and assess how our mod-
els compare to prior work. In §4, we position our
approach with respect to the literature. Finally, in
§5 we draw conclusions and provide avenues for
future work.

2 Variational Multi-modal NMT

Similarly to standard NMT, in MMT we wish to
translate a source sequence xm1 , 〈x1, · · · , xm〉
into a target sequence yn1 , 〈y1, · · · , yn〉. The
main difference is the presence of an image v
which illustrates the sentence pair 〈xm1 , yn1 〉. We
do not model images directly, but instead an 2048-
dimensional vector of pre-activations of a ResNet-
50’s pool5 layer (He et al., 2015).

In our variational MMT models, image features
are assumed to be generated by transforming a
stochastic latent embedding z, which is also used
to inform the RNN decoder in translating source
sentences into a target language.

Generative model We propose a generative
model of translation and image generation where
both the image v and the target sentence yn1 are in-
dependently generated given a common stochastic
embedding z. The generative story is as follows.
We observe a source sentence xm1 and draw an em-
bedding z from a latent Gaussian model,

Z|xm1 ∼ N (µ,diag(σ2))
µ = fµ(x

m
1 ; θ)

σ = fσ(x
m
1 ; θ) ,

(1)

where fµ(·) and fσ(·) map from a source sentence
to a vector of locations µ ∈ Rc and a vector of
scales σ ∈ Rc>0, respectively. We then proceed to

draw the image features from a Gaussian observa-
tion model,

V |z ∼ N (ν, ς2I)
ν = fν(z; θ) ,

(2)

where fν(·) maps from z to a vector of locations
ν ∈ Ro, and ς ∈ R>0 is a hyperparameter of the
model (we use 1). Conditioned on z and on the
source sentence xm1 , and independently of v, we
generate a translation by drawing each target word
in context from a Categorical observation model,

Yj |xm1 , z, y<j ∼ Cat(πj)
πj = fπ(x

m
1 , y<j , z; θ) ,

(3)

where fπ(·) maps z, xm1 , and a prefix translation
y<j to the parameters πj of a categorical distribu-
tion over the target vocabulary. Functions fµ(·),
fσ(·), fν(·), and fπ(·) are implemented as neu-
ral networks whose parameters are collectively de-
noted by θ. In particular, implementing fπ(·) is
as simple as augmenting a standard NMT architec-
ture (Bahdanau et al., 2015; Luong et al., 2015),
i.e. encoder-decoder with attention, with an addi-
tional input z available at every time-step. All other
functions are single-layer MLPs that transform the
average encoder hidden state to the dimensionality
of the corresponding Gaussian variable followed
by an appropriate activation.2

Note that in effect we model a joint distribution

pθ(y
n
1 , v, z|xm1 ) =

pθ(z|xm1 )pθ(v|z)Pθ(yn1 |xm1 , z)
(4)

consisting of three components which we parame-
terise directly. As there are no observations for z,
we cannot estimate these components directly. We
must instead marginalise z out, which yields the
marginal

Pθ(y
n
1 , v|xm1 ) =∫
pθ(z|xm1 )pθ(v|z)Pθ(yn1 |xm1 , z)dz .

(5)

An important statistical consideration about this
model is that even though yn1 and v are condi-
tionally independent given z, they are marginally
dependent. This means that we have designed a
data generating process where our observations

2Locations have support on the entire real space, thus we
use linear activations, scales must be strictly positive, thus we
use a softplus activation.



6394

yy<

zxm1 v

θ

n

N

(a) VMMTC: given the source text xm1 , we model the joint
likelihood of the translation yn1 , the image (features) v,
and a stochastic embedding z sampled from a conditional
latent Gaussian model. Note that the stochastic embedding
is the sole responsible for assigning a probability to the
observation v, and it helps assign a probability to the
translation.

xm1

yn1

z

v

λ

N

(b) Inference model for VMMTC: to approximate the true
posterior we have access to both modalities (text xm1 , yn1
and image v).

Figure 1: Generative model of target text and image features (left), and inference model (right).

yn1 , v|xm1 are not assumed to have been indepen-
dently produced.3 This is in direct contrast with
multi-task learning or joint modelling without la-
tent variables—for an extended discussion see
(Eikema and Aziz, 2019, § 3.1).

Finally, Figure 1 (left) is a graphical depiction
of the generative model: shaded circles denote ob-
served random variables, unshaded circles indicate
latent random variables, deterministic quantities
are not circled; the internal plate indicates iteration
over time-steps, the external plate indicates itera-
tion over the training data. Note that deterministic
parameters θ are global to all training instances,
while stochastic embeddings z are local to each
tuple 〈xm1 , yn1 , v〉.

Inference Parameter estimation for our model is
challenging due to the intractability of the marginal
likelihood function (5). We can however employ
variational inference (VI) (Jordan et al., 1999),
in particular amortised VI (Kingma and Welling,
2014; Rezende et al., 2014), and estimate parame-
ters to maximise a lowerbound

Eqλ(z|xm1 ,yn1 ,v) [log pθ(v|z) + logPθ(y
n
1 |xm1 , z)]

−KL(qλ(z|xm1 , yn1 , v)||pθ(z|xm1 ))
(6)

on the log-likelihood function. This evidence
lowerbound (ELBO) is expressed in terms of an
inference model qλ(z|xm1 , yn1 , v) which we design
having tractability in mind. In particular, our ap-

3This is an aspect of the model we aim to explore more
explicitly in the near future.

proximate posterior is a Gaussian distribution

qλ(z|xm1 , yn1 , v) = N (z|u, diag(s2))
u = gu(x

m
1 , y

n
1 , v;λ)

s = gs(x
m
1 , y

n
1 , v;λ)

(7)

parametrised by an inference network, that is, an in-
dependently parameterised neural network (whose
parameters we denote collectively by λ) which
maps from observations, in our case a sentence
pair and an image, to a variational location u ∈ Rc
and a variational scale s ∈ Rc>0. Figure 1 (right) is
a graphical depiction of the inference model.

Location-scale variables (e.g. Gaussians) can be
reparametrised, i.e. we can obtain a latent sample
via a deterministic transformation of the variational
parameters and a sample from the standard Gaus-
sian distribution:

z = u + �� s where � ∼ N (0, I) . (8)

This reparametrisation enables backpropagation
through stochastic units (Kingma and Welling,
2014; Titsias and Lázaro-Gredilla, 2014). In addi-
tion, for two Gaussians the KL term in the ELBO
(6) can be computed in closed form (Kingma and
Welling, 2014, Appendix B). Altogether, we can
obtain a reparameterised gradient estimate of the
ELBO, we use a single sample estimate of the first
term, and count on stochastic gradient descent to
attain a local optimum of (6).

Architecture All of our parametric functions are
neural network architectures. In particular, fπ is
a standard sequence-to-sequence architecture with
attention and a softmax output. We build upon
OpenNMT (Klein et al., 2017), which we modify



6395

slightly by providing z as additional input to the
target-language decoder at each time step. Loca-
tion layers fµ, fν and gu, and scale layers fσ and
gs, are feed-forward networks with a single ReLU
hidden layer. Furthermore, location layers have a
linear output while scale layers have a softplus out-
put. For the generative model, fµ and fσ transform
the average source-language encoder hidden state.
We let the inference model condition on source-
language encodings without updating them, and
we use a target-language bidirectional LSTM en-
coder in order to also condition on the complete
target sentence. Then gu and gs transform a con-
catenation of the average source-language encoder
hidden state, the average target-language bidirec-
tional encoder hidden state, and the image features.

Fixed Gaussian prior We have just presented
our variational MMT model in its full generality—
we refer to that model as VMMTC. However, keep-
ing in mind that MMT datasets are rather small, it
is desirable to simplify some of our model’s com-
ponents. In particular, the estimated latent Gaus-
sian model (1) can be replaced by a fixed standard
Gaussian prior, i.e., Z ∼ N (0, I)—we refer to this
model as VMMTF. Along with this change it is con-
venient to modify the inference model to condition
on xm1 alone, which allow us to use the inference
model for both training and prediction. Importantly
this also sidesteps the need for a target-language
bidirectional LSTM encoder, which leaves us a
smaller set of inference parameters λ to estimate.
Interestingly, this model does not rely on features
from v, instead only using it as learning signal
through the objective in (6), which is in direct con-
trast with the model of Toyama et al. (2016).

3 Experiments

Our encoder is a 2-layer 500D bidirectional RNN
with GRU, the source and target word embeddings
are 500D, and all are trained jointly with the model.
We use OpenNMT to implement all our models
(Klein et al., 2017). All model parameters are
initialised sampling from a uniform distribution
U(−0.1,+0.1) and bias vectors are initialised to ~0.

Visual features are obtained by feeding images to
the pre-trained ResNet-50 and using the activations
of the pool5 layer (He et al., 2015). We apply
dropout with a probability of 0.5 in the encoder
bidirectional RNN, the image features, the decoder
RNN, and before emitting a target word.

All models are trained using the Adam opti-
miser (Kingma and Ba, 2014) with an initial learn-
ing rate of 0.002 and minibatches of size 40, where
each training instance consists of one English sen-
tence, one German sentence and one image (MMT).
Models are trained for up to 40 epochs and we per-
form model selection based on BLEU4, and use
the best performing model on the validation set to
translate test data. Moreover, we halt training if the
model does not improve BLEU4 scores on the vali-
dation set for 10 epochs or more. We report mean
and standard deviation over 4 independent runs for
all models we trained ourselves (NMT, VMMTF,
VMMTC), and other baseline results are the ones
reported in the authors’ publications (Toyama et al.,
2016; Elliott and Kádár, 2017).

We preprocess our data by tokenizing, lower-
casing, and converting words to subword tokens
using a bilingual BPE model with 10k merge oper-
ations (Sennrich et al., 2016b). We quantitatively
evaluate translation quality using case-insensitive
and tokenized outputs in terms of BLEU4 (Papineni
et al., 2002), METEOR (Denkowski and Lavie,
2014), chrF3 (Popović, 2015), and BEER (Stano-
jević and Sima’an, 2014). By using these, we hope
to include word-level metrics which are tradition-
ally used by the MT community (i.e. BLEU and
METEOR), as well as more recent metrics which
operate at the character level and that better corre-
late with human judgements of translation quality
(i.e. chrF3 and BEER) (Bojar et al., 2017).

3.1 Datasets

The Flickr30k dataset (Young et al., 2014) consists
of images from Flickr and their English descrip-
tions. We use the translated Multi30k (M30kT)
dataset (Elliott et al., 2016), i.e. an extension of
Flickr30k where for each image one of its English
descriptions was translated into German by a pro-
fessional translator. Training, validation and test
sets contain 29k, 1014 and 1k images respectively,
each accompanied by the original English sentence
and its translation into German. In addition to
the test set released for the first run of the multi-
modal translation shared task (Elliott et al., 2016),
henceforth test2016, we also use test2017
released for the next run of this shared task (Elliott
et al., 2017).

Since this dataset is very small, we also investi-
gate the effect of including more in-domain data
to train our models. To that purpose, we use addi-



6396

Model BLEU4↑ METEOR↑ chrF↑ BEER↑

NMT 35.0 (0.4) 54.9 (0.2) 61.0 (0.2) 65.2 (0.1)
Imagination 36.8 (0.8) 55.8 (0.4) – –
Model G 36.5 56.0 – –

VMMTF 37.7 (0.4) ↑ 0.9 56.0 (0.1) ↑ 0.0 62.1 (0.1) ↑ 1.1 66.6 (0.1) ↑ 1.4
VMMTC 37.5 (0.3) ↑ 0.7 55.7 (0.1) ↓ 0.3 61.9 (0.1) ↑ 0.9 66.5 (0.1) ↑ 1.3

Table 1: Results of applying variational MMT models to translate the Multi30k 2016 test set. For each model,
we report the mean and standard deviation over 4 independent runs where models were selected using validation
BLEU4 scores. Best mean baseline scores per metric are underlined and best overall results (i.e. means) are in
bold. We highlight in green/red the improvement brought by our models compared to the best baseline mean score.

tional 145K monolingual German descriptions re-
leased as part of the Multi30k dataset to the task of
image description generation (Elliott et al., 2016).
We refer to this dataset as comparable Multi30k
(M30kC). Descriptions in the comparable Multi30k
were collected independently of existing English
descriptions and describe the same 29K images as
in the M30kT dataset.

In order to obtain features for images, we use
ResNet-50 (He et al., 2015) pre-trained on Ima-
geNet (Russakovsky et al., 2015). We report experi-
ments using pool5 features as our image features,
i.e. 2048-dimensional pre-activations of the last
layer of the network.

In order to investigate how well our models gen-
eralise, we also evaluate our models on the ambigu-
ous MSCOCO test set (Elliott et al., 2017) which
was designed with example sentences that are hard
to translate without resorting to visual context avail-
able in the accompanying image.

Finally, we use a 50D latent embedding z in
our experiments with the translated Multi30k data,
whereas in our ablative experiments and experi-
ments with the comparable Multi30k data, we use
a 500D stochastic embedding z.

3.2 Baselines

We compare our work against three different base-
lines. The first one is a standard text-only sequence-
to-sequence NMT model with attention (Luong
et al., 2015), trained from scratch using hyper-
parameters described above. The second base-
line is the variational multi-modal MT model
Model G proposed by Toyama et al. (2016), where
global image features are used as additional in-
put to condition an inference network. Finally,
a third baseline is the Imagination model of El-
liott and Kádár (2017), a multi-task MMT model

which uses a shared source-language encoder RNN
and is trained in two tasks: to translate from En-
glish into German and on image-sentence ranking
(English↔image).

3.3 Translated Multi30k

We now report on experiments conducted with mod-
els trained to translate from English into German
using the translated Multi30k data set (M30kT).

In Table 1, we compare our variational MMT
models—VMMTC for the general case with a con-
ditional Gaussian latent model, and VMMTF for
the simpler case of a fixed Gaussian prior—to the
three baselines described above. The general trend
is that both formulations of our VMMT improve
with respect to all three baselines. We note an im-
provement in BLEU and METEOR mean scores
compared to the Imagination model (Elliott and
Kádár, 2017), as well as reduced variance (though
note this is based on only 4 independent runs in
our case, and 3 independent runs of Imagination).
Both models VMMTF and VMMTC outperform
Model G according to BLEU and perform com-
parably according to METEOR, especially since
results reported by (Toyama et al., 2016) are based
on a single run. Moreover, we also note that both
our models outperform the text-only NMT base-
line according to all four metrics, and by 1%–1.4%
according chrF3 and BEER, both being metrics
well-suited to measure the quality of translations
into German and generated with subwords units.

In Table 2, we report results when translat-
ing the Multi30k test2017 and the ambiguous
MSCOCO test sets. Note that standard deviations
for the conditional model VMMTC are consider-
ably higher than those obtained for model VMMTF.
We investigated the issue further and found out that
one of the runs of VMMTC performed considerably



6397

Model BLEU4↑ METEOR↑ chrF↑ BEER↑

Multi30k 2017 test set

VMMTF 30.1 (0.3) 49.9 (0.3) 57.2 (0.4) 62.2 (0.3)
VMMTC 26.1 (6.6) 45.4 (7.3) 52.2 (8.4) 58.6 (5.8)

Ambiguous MSCOCO 2017 test set

VMMTF 25.5 (0.5) 44.8 (0.2) 52.0 (0.3) 58.3 (0.2)
VMMTC 21.8 (5.6) 41.2 (6.3) 47.4 (7.6) 55.3 (5.2)

Table 2: Results of applying variational MMT models to translate the Multi30k 2017 and the ambiguous MSCOCO
test sets. For each model, we report the mean and standard deviation over 4 independent runs where models were
selected using validation BLEU4 scores. Best overall results (i.e. means) are in bold. Note that standard deviations
for the conditional model VMMTC are considerably higher than those obtained for model VMMTF. This is partly
due to the fact that one of the runs of VMMTC underperformed compared to the other three.

worse than the others; this caused the mean scores
to be much lower and also increased the variance
significantly.

Finally, one interesting finding is that all four
metrics indicate that the fixed-prior model VMMTF
either performs slightly (Table 1) or consider-
ably better (Table 2) than the conditional model
VMMTC. We speculate this is partly due to
VMMTF’s simpler parameterisation, after all, we
have just about 29k training instances to estimate
two sets of parameters (θ and λ) and the more com-
plex VMMTC requires an additional bidirectional
LSTM encoder for the target text.

3.4 Back-translated Comparable Multi30k

Since the translated Multi30k dataset is very small,
we also investigate the effect of including more
in-domain data to train our models. For that pur-
pose, we use additional 145K monolingual German
descriptions released as part of the comparable
Multi30k dataset (M30kC). We train a text-only
NMT model to translate from German into English
using the original 29K parallel sentences in the
translated Multi30k (without images), and apply
this model to back-translate the 145K German de-
scriptions into English (Sennrich et al., 2016a).

In this set of experiments, we explore how pre-
training models NMT, VMMTF and VMMTC using
both the translated and back-translated compara-
ble Multi30k affects results. Models are pre-trained
on mini-batches with a one-to-one ratio of trans-
lated and back-translated data.4 All three mod-
els NMT, VMMTF and VMMTC, are further fine-

4One pre-training epoch corresponds to about 290K exam-
ples, i.e. we up-sample the smaller translated Multi30k data
set to achieve the one-to-one ratio.

Figure 2: Validation set BLEU scores per number of
pre-trained epochs for models VMMTC and VMMTF
pre-trained using the comparable Multi30k and trans-
lated Multi30k data sets. The height of a bar represents
the mean and the black vertical lines indicate ±1 std
over 4 independent runs.

tuned on the translated Multi30k until convergence,
and model selection using BLEU is only applied
during fine-tuning and not at the pre-training stage.

In Figure 2, we inspect for how many epochs
should a model be pre-trained using the additional
noisy back-translated descriptions, and note that
both VMMTF and VMMTC reach best BLEU
scores on the validation set when pre-trained for
about 3 epochs. As shown in Figure 2, we note
that when using additional noisy data VMMTC,
which uses a conditional prior, performs consider-
ably better than its counterpart VMMTF, which has
a fixed prior. These results indicate that VMMTC
makes better use of additional synthetic data than
VMMTF. Some of the reasons that explain these
results are (i) the conditional prior p(z|x) can learn



6398

Model BLEU4↑ METEOR↑ # train
sents.

NMT 37.7 (0.5) 56.0 (0.3)
145KVMMTF 38.4 (0.6) -↑ 0.7 56.0 (0.3) -↑ 0.0

VMMTC 38.4 (0.2) -↑ 0.7 56.3 (0.2) -↑ 0.3

Imagination 37.8 (0.7) 57.1 (0.2) 654K

Table 3: Results for models pre-trained using the
translated and comparable Multi30k to translate the
Multi30k test set. We report the mean and standard
deviation over 4 independent runs. Our best over-
all results are highlighted in bold, and we highlight
in green/red the improvement/decrease brought by our
models compared to the baseline mean score. We addi-
tionally show results for the Imagination model trained
on 4× more data (as reported in the authors’ paper).

to be sensitive to whether x is gold-standard or syn-
thetic, whereas p(z) cannot; (ii) in the conditional
case the posterior approximation q(z|x, y, v) can
directly exploit different patterns arising from a
gold-standard versus a synthetic 〈x, y〉 pair; and
finally (iii) our synthetic data is made of target-
language gold-standard image descriptions, which
help train the inference network’s target-language
BiLSTM encoder.

In Table 3, we show results when applying
VMMTF and VMMTC to translate the Multi30k
test set. Both models and the NMT baseline are pre-
trained on the translated and the back-translated
comparable Multi30k data sets, and are selected
according to validation set BLEU scores. For
comparison, we also include results for Imagina-
tion (Elliott and Kádár, 2017) when trained on the
translated Multi30k, the WMT News Commentary
English-German dataset (240K parallel sentence
pairs) and the MSCOCO image description dataset
(414K German descriptions of 83K images, i.e. 5
descriptions for each image). In contrast, our mod-
els observe 29K images (i.e. the same as the mod-
els evaluated in Section 3.3) plus 145K German
descriptions only.5

3.5 Ablative experiments

In our ablation we are interested in finding out to
what extent the model makes use of the latent space,
i.e. how important is the latent variable.

KL free bits A common issue when training la-
tent variable models with a strong decoder is having

5There are no additional images because the comparable
Multi30k consists of additional German descriptions for the
same 29K images already in the translated Multi30k.

Model Number of BLEU4↑
free bits (KL)

VMMTF

0 38.3 (0.2)
1 38.1 (0.3)
2 38.4 (0.4)
4 38.4 (0.4)
8 35.7 (3.1)

VMMTC

0 38.5 (0.2)
1 38.3 (0.3)
2 38.2 (0.2)
4 36.8 (2.6)
8 38.6 (0.2)

Table 4: Results of applying VMMT models trained
with different numbers of free bits in the KL (Kingma
et al., 2016) to translate the Multi30k validation set.

the true posterior collapse to the prior and the KL
term in the ELBO vanish to zero. In practice, that
would mean the model has virtually not used the
latent variable z to predict image features v, but
mostly as a source of stochasticity in the decoder.
This can happen because the model has access to
informative features from the source bi-LSTM en-
coder and need not learn a difficult mapping from
observations to latent representations predictive of
image features.

For that reason, we wish to measure how well
can we train latent variable MMT models while
ensuring that the KL term in the loss (Equation (6))
does not vanish to zero. We use the free bits heuris-
tic (Kingma et al., 2016) to impose a constraint
on the KL, which in turn promotes models with
non-negligible mutual information between inputs
and latent variables (Alemi et al., 2018).

In Table 4, we see the results of different mod-
els trained using different number of free bits in
the KL component. We note that including free
bits improves translations slightly, but note that
finding the optimal number of free bits requires
hyper-parameter search.

3.6 Discussion

In Table 5 we show how our different models trans-
late two examples of the M30k test set. In the
first example (id#801), training on additional back-
translated data improves variational models but not
the NMT baseline, whereas in the second example
(id#873) differences between baseline and varia-
tional models still persist even when training on



6399

Model Example #801 Example #873

source a man on a bycicle pedals through an archway . a man throws a fishing net into the bay .
reference ein mann fährt auf einem fahrrad durch einen torbogen . ein mann wirft ein fischernetz in die bucht .

M30kT M30kT
NMT ein mann auf einem fahrrad fährt durch eine scheibe . ein mann wirft ein fischernetz in die luft .
VMMTF ein mann auf einem fahrrad fährt durch einen torbogen . ein mann wirft ein fischernetz in die bucht .
VMMTC ein mann auf einem fahrrad fährt durch einen bogen . ein mann wirft ein fischernetz in die bucht .

M30kT + back-translated M30kC M30kT + back-translated M30kC
NMT ein mann auf einem fahrrad fährt durch einen bogen . ein mann wirft ein fischernetz ins meer .
VMMTF ein mann auf einem fahrrad fährt durch einen torbogen . ein mann wirft ein fischernetz in den wellen .
VMMTC ein mann auf einem fahrrad fährt durch einen torbogen . ein mann wirft ein fischernetz in die bucht .

Table 5: Translations for examples 801 and 873 of the M30k test set. In the first example, neither the NMT baseline
(with or without back-translated data) nor model VMMTC (trained on limited data) could translate archway cor-
rectly; the NMT baseline translates it as “scheibe” (disk) and “bogen” (bow), and VMMTC also incorrectly trans-
lates it as “bogen” (bow). However, VMMTC translates without errors when trained on additional back-translated
data, i.e. “torbogen” (archway). In the second example, the NMT baseline translates bay as “luft” (air) or “meer”
(sea), whereas VMMTF translates it as “bucht” (bay) or “wellen” (waves) and VMMTC always as “bucht” (bay).

additional back-translated data.

4 Related work

Even though there has been growing interest in vari-
ational approaches to machine translation (Zhang
et al., 2016; Schulz et al., 2018; Shah and Bar-
ber, 2018; Eikema and Aziz, 2019) and to tasks
that integrate vision and language, e.g. image de-
scription generation (Pu et al., 2016; Wang et al.,
2017), relatively little attention has been dedicated
to variational models for multi-modal translation.
This is partly due to the fact that multi-modal ma-
chine translation was only recently addressed by
the MT community by means of a shared task (Spe-
cia et al., 2016; Elliott et al., 2017; Barrault et al.,
2018). Nevertheless, we now discuss relevant vari-
ational and deterministic multi-modal MT models
in the literature.

Fully supervised MMT models. All submis-
sions to the three runs of the multi-modal MT
shared tasks (Specia et al., 2016; Elliott et al., 2017;
Barrault et al., 2018) model conditional probabili-
ties directly without latent variables.

Perhaps the first MMT model proposed prior to
these shared tasks is that of Hitschler et al. (2016),
who used image features to re-rank translations of
image descriptions generated by a phrase-based
statistical MT model (PBSMT) and reported sig-
nificant improvements. Shah et al. (2016) propose
a similar model where image logits are used to re-
rank the output of PBSMT. Global image features,
i.e. features computed over an entire image (such
as pool5 ResNet-50 features used in this work),
have been directly used as “tokens” in the source
sentence, to initialise encoder RNN hidden states,
or as additional information used to initialise the

decoder RNN states (Huang et al., 2016; Libovický
et al., 2016; Calixto and Liu, 2017). On the other
hand, spatial visual features, i.e. local features that
encode different parts of the image separately in dif-
ferent vectors, have been used in doubly-attentive
models where there is one attention mechanism
over the source RNN hidden states and another
one over the image features (Caglayan et al., 2016;
Calixto et al., 2017).

Finally, Caglayan et al. (2017) proposed to in-
teract image features with target word embeddings,
more specifically to perform an element-wise mul-
tiplication of the (projected) global image features
and the target word embeddings before feeding the
target word embeddings into their decoder GRU.
They reported significant improvements by using
image features to gate target word embeddings and
won the 2017 Multi-modal MT shared task (Elliott
et al., 2017).

Multi-task MMT models. Multi-task learning
MMT models are easily applicable to translate sen-
tences without images (at test time), which is an
advantage over the above-mentioned models.

Luong et al. (2016) proposed a multi-task ap-
proach where a model is trained using two tasks
and a shared decoder: the main task is to translate
from German into English and the secondary task
is to generate English descriptions given an image.
They show improvements in the main translation
task when also training for the secondary image
description task. Their model is large, i.e. a 4-layer
encoder LSTM and a 4-layer decoder LSTM, and
their best set up uses a ratio of 0.05 image descrip-
tion generation training data samples in compar-
ison to translation training data samples. Elliott
and Kádár (2017) propose an MTL model trained



6400

to do translation (English→German) and sentence-
image ranking (English↔image), using a standard
word cross-entropy and margin-based losses as its
task objectives, respectively. Their model uses the
pre-trained GoogleNet v3 CNN (Szegedy et al.,
2016) to extract pool5 features, and has a 1-layer
source-language bidirectional GRU encoder and a
1-layer GRU decoder.

Variational MMT models. Toyama et al. (2016)
proposed a variational MMT model that is likely
the most similar model to the one we put forward
in this work. They build on the variational neural
MT (VNMT) model of Zhang et al. (2016), which
is a conditional latent model where a Gaussian-
distributed prior of z is parameterised as a function
of the the source sentence xm1 , i.e. p(z|xm1 ), and
both xm1 and z are used at each time step in an
attentive decoder RNN, P (yj |xm1 , z, y<j).

In Toyama et al. (2016), image features are used
as input to the inference model qλ(z|xm1 , yn1 , v) that
approximates the posterior over the latent variable,
but otherwise are not modelled and not used in the
generative network. Differently from their work,
we use image features in all our generative models,
and propose modelling them as random observed
outcomes while still being able to use our model
to translate without images at test time. In the con-
ditional case, we further use image features for
posterior inference. Additionally, we also investi-
gate both conditional and fixed priors, i.e. p(z|xm1 )
and p(z), whereas their model is always condi-
tional. Interestingly, we found in our experiments
that fixed-prior models perform slightly better than
conditional ones under limited training data.

Toyama et al. (2016) uses the pre-trained VGG19
CNN (Simonyan and Zisserman, 2015) to extract
FC7 features, and additionally experiment with
using additional features from object detections
obtained with the Fast RCNN network (Girshick,
2015). One more difference between their work
and ours is that we only use the ResNet-50 network
to extract pool5 features, and no additional pre-
trained CNN nor object detections.

5 Conclusions and Future work

We have proposed a latent variable model for multi-
modal neural machine translation and have shown
benefits from both modelling images and promot-
ing use of latent space. We also show that in the ab-
sence of enough data to train a more complex infer-
ence network a simple fixed prior suffices, whereas

when more training data is available (even noisy
data) a conditional prior is preferable. Importantly,
our models compare favourably to the state-of-the-
art.

In future work we will explore other generative
models for multi-modal MT, as well as different
ways to directly incorporate images into these mod-
els. We are also interested in modelling different
views of the image, such as global vs. local image
features, and also in using larger image collections
and modelling images directly, i.e. pixel intensi-
ties.

Acknowledgements

This work is supported by the Dutch Organisation
for Scientific Research (NWO) VICI Grant nr. 277-
89-002.

References

Alexander A. Alemi, Ben Poole, Ian Fischer,
Joshua V. Dillon, Rif A. Saurous, and Kevin
Murphy. 2018. Fixing a Broken ELBO. In
Proceedings of the 35th International Confer-
ence on Machine Learning, ICML 2018, pages
159–168.

Dzmitry Bahdanau, Kyunghyun Cho, and Yoshua
Bengio. 2015. Neural Machine Translation by
Jointly Learning to Align and Translate. In
International Conference on Learning Repre-
sentations, ICLR 2015, San Diego, California.

Loı̈c Barrault, Fethi Bougares, Lucia Specia, Chi-
raag Lala, Desmond Elliott, and Stella Frank.
2018. Findings of the Third Shared Task
on Multimodal Machine Translation. In Pro-
ceedings of the Third Conference on Machine
Translation: Shared Task Papers, pages 304–
323, Belgium, Brussels. Association for Com-
putational Linguistics.

Ondřej Bojar, Yvette Graham, and Amir Kamran.
2017. Results of the WMT17 Metrics Shared
Task. In Proceedings of the Second Confer-
ence on Machine Translation, pages 489–513,
Copenhagen, Denmark. Association for Com-
putational Linguistics.

Ozan Caglayan, Walid Aransa, Adrien Bardet, Mer-
cedes Garcı́a-Martı́nez, Fethi Bougares, Loı̈c
Barrault, Marc Masana, Luis Herranz, and
Joost van de Weijer. 2017. LIUM-CVC Sub-
missions for WMT17 Multimodal Translation

https://www.aclweb.org/anthology/W18-6402
https://www.aclweb.org/anthology/W18-6402
http://www.aclweb.org/anthology/W17-4755
http://www.aclweb.org/anthology/W17-4755
http://www.aclweb.org/anthology/W17-4746
http://www.aclweb.org/anthology/W17-4746


6401

Task. In Proceedings of the Second Confer-
ence on Machine Translation, pages 432–439,
Copenhagen, Denmark. Association for Com-
putational Linguistics.

Ozan Caglayan, Loı̈c Barrault, and Fethi Bougares.
2016. Multimodal attention for neural ma-
chine translation. CoRR, abs/1609.03976.

Iacer Calixto and Qun Liu. 2017. Incorporating
Global Visual Features into Attention-based
Neural Machine Translation. In Proceedings
of the 2017 Conference on Empirical Methods
in Natural Language Processing, pages 992–
1003, Copenhagen, Denmark. Association for
Computational Linguistics.

Iacer Calixto, Qun Liu, and Nick Campbell. 2017.
Doubly-Attentive Decoder for Multi-modal
Neural Machine Translation. In Proceedings
of the 55th Annual Meeting of the Associa-
tion for Computational Linguistics (Volume
1: Long Papers), pages 1913–1924, Vancou-
ver, Canada. Association for Computational
Linguistics.

Michael Denkowski and Alon Lavie. 2014. Me-
teor Universal: Language Specific Transla-
tion Evaluation for Any Target Language. In
Proceedings of the EACL 2014 Workshop on
Statistical Machine Translation.

Bryan Eikema and Wilker Aziz. 2019. Auto-
encoding variational neural machine trans-
lation. In 4th Workshop on Representation
Learning for NLP.

Desmond Elliott, Stella Frank, Loı̈c Barrault, Fethi
Bougares, and Lucia Specia. 2017. Findings
of the second shared task on multimodal ma-
chine translation and multilingual image de-
scription. In Proceedings of the Second Con-
ference on Machine Translation, pages 215–
233, Copenhagen, Denmark. Association for
Computational Linguistics.

Desmond Elliott, Stella Frank, Khalil Sima’an, and
Lucia Specia. 2016. Multi30K: Multilingual
English-German Image Descriptions. In Pro-
ceedings of the 5th Workshop on Vision and
Language, VL@ACL 2016, Berlin, Germany.

Desmond Elliott and Ákos Kádár. 2017. Imagi-
nation improves multimodal translation. In

Proceedings of the Eighth International Joint
Conference on Natural Language Processing
(Volume 1: Long Papers), pages 130–141,
Taipei, Taiwan. Asian Federation of Natural
Language Processing.

Ross Girshick. 2015. Fast R-CNN. In Proceedings
of the 2015 IEEE International Conference on
Computer Vision (ICCV), ICCV ’15, pages
1440–1448, Washington, DC, USA. IEEE
Computer Society.

Kaiming He, Xiangyu Zhang, Shaoqing Ren,
and Jian Sun. 2015. Deep Residual Learn-
ing for Image Recognition. arXiv preprint
arXiv:1512.03385.

Julian Hitschler, Shigehiko Schamoni, and Stefan
Riezler. 2016. Multimodal Pivots for Image
Caption Translation. In Proceedings of the
54th Annual Meeting of the Association for
Computational Linguistics (Volume 1: Long
Papers), pages 2399–2409, Berlin, Germany.

Sepp Hochreiter and Jürgen Schmidhuber. 1997.
Long short-term memory. Neural Comput.,
9(8):1735–1780.

Po-Yao Huang, Frederick Liu, Sz-Rung Shiang,
Jean Oh, and Chris Dyer. 2016. Attention-
based Multimodal Neural Machine Transla-
tion. In Proceedings of the First Confer-
ence on Machine Translation, pages 639–645,
Berlin, Germany.

MichaelI. Jordan, Zoubin Ghahramani, TommiS.
Jaakkola, and LawrenceK. Saul. 1999. An
introduction to variational methods for graph-
ical models. Machine Learning, 37(2):183–
233.

Diederik P. Kingma and Jimmy Ba. 2014. Adam:
A method for stochastic optimization. CoRR,
abs/1412.6980.

Diederik P Kingma, Tim Salimans, Rafal Jozefow-
icz, Xi Chen, Ilya Sutskever, and Max Welling.
2016. Improved variational inference with
inverse autoregressive flow. In D. D. Lee,
M. Sugiyama, U. V. Luxburg, I. Guyon, and
R. Garnett, editors, Advances in Neural Infor-
mation Processing Systems 29, pages 4743–
4751. Curran Associates, Inc.

http://www.aclweb.org/anthology/W17-4746
http://arxiv.org/abs/1609.03976
http://arxiv.org/abs/1609.03976
http://aclweb.org/anthology/D17-1105
http://aclweb.org/anthology/D17-1105
http://aclweb.org/anthology/D17-1105
http://aclweb.org/anthology/P17-1175
http://aclweb.org/anthology/P17-1175
http://www.aclweb.org/anthology/W17-4718
http://www.aclweb.org/anthology/W17-4718
http://www.aclweb.org/anthology/W17-4718
http://www.aclweb.org/anthology/W17-4718
http://aclweb.org/anthology/W/W16/W16-3210.pdf
http://aclweb.org/anthology/W/W16/W16-3210.pdf
http://www.aclweb.org/anthology/I17-1014
http://www.aclweb.org/anthology/I17-1014
https://doi.org/10.1109/ICCV.2015.169
http://www.aclweb.org/anthology/P16-1227
http://www.aclweb.org/anthology/P16-1227
https://doi.org/10.1162/neco.1997.9.8.1735
http://www.aclweb.org/anthology/W/W16/W16-2360
http://www.aclweb.org/anthology/W/W16/W16-2360
http://www.aclweb.org/anthology/W/W16/W16-2360
http://arxiv.org/abs/1412.6980
http://arxiv.org/abs/1412.6980
http://papers.nips.cc/paper/6581-improved-variational-inference-with-inverse-autoregressive-flow.pdf
http://papers.nips.cc/paper/6581-improved-variational-inference-with-inverse-autoregressive-flow.pdf


6402

Diederik P. Kingma and Max Welling. 2014. Auto-
encoding variational bayes. In International
Conference on Learning Representations.

Guillaume Klein, Yoon Kim, Yuntian Deng, Jean
Senellart, and Alexander M. Rush. 2017.
OpenNMT: Open-source toolkit for neural ma-
chine translation. In Proc. ACL.

Jindřich Libovický and Jindřich Helcl. 2017. At-
tention Strategies for Multi-Source Sequence-
to-Sequence Learning. In Proceedings of the
55th Annual Meeting of the Association for
Computational Linguistics (Volume 2: Short
Papers), pages 196–202, Vancouver, Canada.
Association for Computational Linguistics.

Jindřich Libovický, Jindřich Helcl, Marek Tlustý,
Ondřej Bojar, and Pavel Pecina. 2016. CUNI
System for WMT16 Automatic Post-Editing
and Multimodal Translation Tasks. In Pro-
ceedings of the First Conference on Machine
Translation, pages 646–654, Berlin, Germany.

Minh-Thang Luong, Quoc V. Le, Ilya Sutskever,
Oriol Vinyals, and Lukasz Kaiser. 2016.
Multi-Task Sequence to Sequence Learning.
In Proceedings of the International Confer-
ence on Learning Representations (ICLR),
2016, San Juan, Puerto Rico.

Thang Luong, Hieu Pham, and Christopher D.
Manning. 2015. Effective Approaches to
Attention-based Neural Machine Translation.
In Proceedings of the 2015 Conference on
Empirical Methods in Natural Language Pro-
cessing (EMNLP), pages 1412–1421, Lisbon,
Portugal.

Kishore Papineni, Salim Roukos, Todd Ward, and
Wei-Jing Zhu. 2002. BLEU: A Method for
Automatic Evaluation of Machine Translation.
In Proceedings of the 40th Annual Meeting
on Association for Computational Linguistics,
ACL ’02, pages 311–318, Philadelphia, Penn-
sylvania.

Maja Popović. 2015. chrF: character n-gram F-
score for automatic MT evaluation. In Pro-
ceedings of the Tenth Workshop on Statistical
Machine Translation, pages 392–395, Lisbon,
Portugal. Association for Computational Lin-
guistics.

Yunchen Pu, Zhe Gan, Ricardo Henao, Xin Yuan,
Chunyuan Li, Andrew Stevens, and Lawrence
Carin. 2016. Variational autoencoder for deep
learning of images, labels and captions. In
D. D. Lee, M. Sugiyama, U. V. Luxburg,
I. Guyon, and R. Garnett, editors, Advances
in Neural Information Processing Systems 29,
pages 2352–2360. Curran Associates, Inc.

Danilo Jimenez Rezende, Shakir Mohamed, and
Daan Wierstra. 2014. Stochastic backprop-
agation and approximate inference in deep
generative models. In Proceedings of the 31th
International Conference on Machine Learn-
ing, ICML 2014, Beijing, China, 21-26 June
2014, pages 1278–1286.

Olga Russakovsky, Jia Deng, Hao Su, Jonathan
Krause, Sanjeev Satheesh, Sean Ma, Zhi-
heng Huang, Andrej Karpathy, Aditya Khosla,
Michael Bernstein, Alexander C. Berg, and
Li Fei-Fei. 2015. ImageNet Large Scale
Visual Recognition Challenge. Interna-
tional Journal of Computer Vision (IJCV),
115(3):211–252.

Philip Schulz, Wilker Aziz, and Trevor Cohn. 2018.
A stochastic decoder for neural machine trans-
lation. In Proceedings of the 56th Annual
Meeting of the Association for Computational
Linguistics (Volume 1: Long Papers), pages
1243–1252. Association for Computational
Linguistics.

Rico Sennrich, Barry Haddow, and Alexandra
Birch. 2016a. Improving Neural Machine
Translation Models with Monolingual Data.
In Proceedings of the 54th Annual Meeting
of the Association for Computational Linguis-
tics (Volume 1: Long Papers), pages 86–96,
Berlin, Germany. Association for Computa-
tional Linguistics.

Rico Sennrich, Barry Haddow, and Alexandra
Birch. 2016b. Neural Machine Translation of
Rare Words with Subword Units. In Proceed-
ings of the 54th Annual Meeting of the Associ-
ation for Computational Linguistics (Volume
1: Long Papers), pages 1715–1725, Berlin,
Germany.

Harshil Shah and David Barber. 2018. Genera-
tive neural machine translation. In S. Ben-
gio, H. Wallach, H. Larochelle, K. Grauman,

https://doi.org/10.18653/v1/P17-4012
https://doi.org/10.18653/v1/P17-4012
http://aclweb.org/anthology/P17-2031
http://aclweb.org/anthology/P17-2031
http://aclweb.org/anthology/P17-2031
http://www.aclweb.org/anthology/W/W16/W16-2361
http://www.aclweb.org/anthology/W/W16/W16-2361
http://www.aclweb.org/anthology/W/W16/W16-2361
https://doi.org/10.3115/1073083.1073135
https://doi.org/10.3115/1073083.1073135
http://aclweb.org/anthology/W15-3049
http://aclweb.org/anthology/W15-3049
http://papers.nips.cc/paper/6528-variational-autoencoder-for-deep-learning-of-images-labels-and-captions.pdf
http://papers.nips.cc/paper/6528-variational-autoencoder-for-deep-learning-of-images-labels-and-captions.pdf
https://doi.org/10.1007/s11263-015-0816-y
https://doi.org/10.1007/s11263-015-0816-y
http://aclweb.org/anthology/P18-1115
http://aclweb.org/anthology/P18-1115
http://www.aclweb.org/anthology/P16-1009
http://www.aclweb.org/anthology/P16-1009
http://www.aclweb.org/anthology/P16-1162
http://www.aclweb.org/anthology/P16-1162
http://papers.nips.cc/paper/7409-generative-neural-machine-translation.pdf
http://papers.nips.cc/paper/7409-generative-neural-machine-translation.pdf


6403

N. Cesa-Bianchi, and R. Garnett, editors, Ad-
vances in Neural Information Processing Sys-
tems 31, pages 1346–1355. Curran Associates,
Inc.

Kashif Shah, Josiah Wang, and Lucia Specia.
2016. SHEF-Multimodal: Grounding Ma-
chine Translation on Images. In Proceedings
of the First Conference on Machine Transla-
tion, pages 660–665, Berlin, Germany.

K. Simonyan and A. Zisserman. 2015. Very deep
convolutional networks for large-scale image
recognition. In Proceedings of the Interna-
tional Conference on Learning Representa-
tions (ICLR), San Diego, CA.

Kihyuk Sohn, Honglak Lee, and Xinchen Yan.
2015. Learning structured output represen-
tation using deep conditional generative mod-
els. In C. Cortes, N. D. Lawrence, D. D. Lee,
M. Sugiyama, and R. Garnett, editors, Ad-
vances in Neural Information Processing Sys-
tems 28, pages 3483–3491. Curran Associates,
Inc.

Lucia Specia, Stella Frank, Khalil Sima’an, and
Desmond Elliott. 2016. A Shared Task
on Multimodal Machine Translation and
Crosslingual Image Description. In Pro-
ceedings of the First Conference on Machine
Translation, WMT 2016, colocated with ACL
2016, pages 543–553, Berlin, Germany.

Miloš Stanojević and Khalil Sima’an. 2014. Fit-
ting sentence level translation evaluation with
many dense features. In Proceedings of
the 2014 Conference on Empirical Methods
in Natural Language Processing (EMNLP),
pages 202–206, Doha, Qatar. Association for
Computational Linguistics.

Ilya Sutskever, Oriol Vinyals, and Quoc V. V
Le. 2014. Sequence to sequence learning
with neural networks. In Z. Ghahramani,
M. Welling, C. Cortes, N.D. Lawrence, and
K.Q. Weinberger, editors, Advances in Neu-
ral Information Processing Systems 27, pages
3104–3112. Curran Associates, Inc.

C. Szegedy, V. Vanhoucke, S. Ioffe, J. Shlens, and
Z. Wojna. 2016. Rethinking the inception ar-
chitecture for computer vision. In 2016 IEEE
Conference on Computer Vision and Pattern
Recognition (CVPR), pages 2818–2826.

Michalis Titsias and Miguel Lázaro-Gredilla. 2014.
Doubly stochastic variational bayes for non-
conjugate inference. In Proceedings of the
31st International Conference on Machine
Learning (ICML-14), pages 1971–1979.

Joji Toyama, Masanori Misono, Masahiro Suzuki,
Kotaro Nakayama, and Yutaka Matsuo. 2016.
Neural machine translation with latent seman-
tic of image and text. CoRR, abs/1611.08459.

Liwei Wang, Alexander Schwing, and Svetlana
Lazebnik. 2017. Diverse and accurate image
description using a variational auto-encoder
with an additive gaussian encoding space. In
I. Guyon, U. V. Luxburg, S. Bengio, H. Wal-
lach, R. Fergus, S. Vishwanathan, and R. Gar-
nett, editors, Advances in Neural Informa-
tion Processing Systems 30, pages 5756–5766.
Curran Associates, Inc.

Peter Young, Alice Lai, Micah Hodosh, and Julia
Hockenmaier. 2014. From image descriptions
to visual denotations: New similarity metrics
for semantic inference over event descriptions.
Transactions of the Association for Computa-
tional Linguistics, 2:67–78.

Biao Zhang, Deyi Xiong, jinsong su, Hong Duan,
and Min Zhang. 2016. Variational neural ma-
chine translation. In Proceedings of the 2016
Conference on Empirical Methods in Natural
Language Processing, pages 521–530, Austin,
Texas. Association for Computational Linguis-
tics.

http://www.aclweb.org/anthology/W/W16/W16-2363
http://www.aclweb.org/anthology/W/W16/W16-2363
http://aclweb.org/anthology/W/W16/W16-2346.pdf
http://aclweb.org/anthology/W/W16/W16-2346.pdf
http://aclweb.org/anthology/W/W16/W16-2346.pdf
http://www.aclweb.org/anthology/D14-1025
http://www.aclweb.org/anthology/D14-1025
http://www.aclweb.org/anthology/D14-1025
http://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf
http://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf
https://doi.org/10.1109/CVPR.2016.308
https://doi.org/10.1109/CVPR.2016.308
http://arxiv.org/abs/1611.08459
http://arxiv.org/abs/1611.08459
http://papers.nips.cc/paper/7158-diverse-and-accurate-image-description-using-a-variational-auto-encoder-with-an-additive-gaussian-encoding-space.pdf
http://papers.nips.cc/paper/7158-diverse-and-accurate-image-description-using-a-variational-auto-encoder-with-an-additive-gaussian-encoding-space.pdf
http://papers.nips.cc/paper/7158-diverse-and-accurate-image-description-using-a-variational-auto-encoder-with-an-additive-gaussian-encoding-space.pdf
https://aclweb.org/anthology/D16-1050
https://aclweb.org/anthology/D16-1050


6404

A Model Architecture

Once again, we wish to translate a source sequence
xm1 , 〈x1, · · · , xm〉 into a target sequence yn1 ,
〈y1, · · · , yn〉, and also predict image features v.

xv y

µ σ

z

y v

λ

θ

inference
model

generative
model

� ∼ N (0, I)

KL KL

Figure 3: Illustration of multi-modal machine transla-
tion generative and inference models. The conditional
model VMMTC includes dashed arrows; the fixed prior
model VMMTF does not, i.e. its inference network
only uses x.

In Figure 3, we illustrate generative and infer-
ence networks for models VMMTC and VMMTF.

A.1 Generative model

Source-language encoder The source-language
encoder is deterministic and implemented using
a 2-layer bidirectional Long Short-Term Memory
(LSTM) network (Hochreiter and Schmidhuber,
1997):

fi = emb(xi; θemb-x),

h0 = ~0,
−→
h i = LSTM(hi−1,fi; θlstmf-x),
←−
h i = LSTM(hi+1,fi; θlstmb-x),

hi = [
−→
h i,
←−
h i],

(9)

where emb is the source look-up matrix, trained
jointly with the model, and hm1 are the final source
hidden states.

Target-language decoder Now we assume that
z is given, and will discuss how to compute it later
on. The translation model consists of a sequence
of draws from a Categorical distribution over the
target-language vocabulary (independently from
image features v):

Yj |z, x, y<j ∼ Cat(fθ(z, x, y<j)),

where fθ parameterises the distribution with an
attentive encoder-decoder architecture:

wj = emb(yj ; θemb-y),

s0 = tanh
(
affine(hm1 ; θinit-y)

)
,

sj = LSTM(sj−1, [wj , z]; θlstm-y),

ci,j = attention(h
m
1 , s

n
1 ; θattn),

fθ(z, x, y<j) = softmax(affine([sj , cj ]; θout-y)),

where the attention mechanism is a bi-
linear attention (Luong et al., 2015),
and the generative parameters are θ =
{θemb-{x,y}, θlstm{f,b}-x, θinit-y, θlstm-y, θattn, θout-y}.

Image decoder We do not model images directly,
but instead as a 2048-dimensional feature vector v
of pre-activations of a ResNet-50’s pool5 layer.
We simply draw image features from a Gaussian
observation model:

V |z ∼ N (ν, ς2I),
ν = MLP(z; θ), (10)

where a multi-layer perceptron (MLP) maps from
z to a vector of locations ν ∈ Ro, and ς ∈ R>0 is
a hyper-parameter of the model (we use 1).

Conditional prior VMMTC Given a source sen-
tence xm1 , we draw an embedding z from a latent
Gaussian model:

Z|xm1 ∼ N (µ, diag(σ2)),
µ = MLP(hm1 ; θlatent), (11)

σ = softplus(MLP(hm1 ; θlatent)) , (12)

where Equations (11) and (12) employ two multi-
layer perceptrons (MLPs) to map from a source
sentence (i.e. source hidden states) to a vector of
locations µ ∈ Rc and a vector of scales σ ∈ Rc>0,
respectively.

Fixed prior VMMTF In the MMT model
VMMTF, we simply have a draw from a standard
Normal prior:

Z ∼ N (0, I).

All MLPs have one hidden layer and are imple-
mented as below (eqs. (10) to (12)):

MLP(·) = affine(ReLU(affine( · ; θ)); θ).

A.2 Inference model
The inference network shares the source-language
encoder with the generative model and differs de-
pending on the model (VMMTC or VMMTF).



6405

Conditional prior VMMTC Model VMMTC’s
approximate posterior qλ(z|xm1 , yn1 , v) is a Gaus-
sian distribution:

Z|xm1 , yn1 , v ∼ N (u, diag(s2);λ).

We use two bidirectional LSTMs, one over source-
and the other over target-language words, respec-
tively. To reduce the number of model parame-
ters, we re-use the entire source-language BiLSTM
and the target-language embeddings in the gener-
ative model but prevent updates to the generative
model’s parameters by blocking gradients from be-
ing back-propagated (Equation 9). Concretely, the
inference model is parameterised as below:

hm1 = detach(BiLSTM(x
m
1 ; θemb-x,lstmf-x,lstmb-x)),

wn1 = detach(emb(y
n
1 ; θemb-y)),

hx = avg(affine(h
m
1 ;λx)),

hy = avg(BiLSTM(w
n
1 ;λy)),

hv = MLP(v;λv),

hall = [hx,hy,hv],

u = MLP(hall;λmu),

s = softplus(MLP(hall;λsigma)),

where the set of the inference network parameters
are λ = {λx, λy, λv, λmu, λsigma}.

Fixed prior VMMTF Model VMMTF’s approx-
imate posterior qλ(z|xm1 ) is also a Gaussian:

Z|xm1 ∼ N (u,diag(s2);λ),

where we re-use the source-language BiLSTM
from the generative model but prevent updates to its
parameters by blocking gradients from being back-
propagated (Equation 9). Concretely, the inference
model is parameterised as below:

hm1 = detach(BiLSTM(x
m
1 ; θemb-x,lstmf-x,lstmb-x)),

hx = avg(affine(h
m
1 ;λx)),

u = MLP(hx;λmu),

s = softplus(MLP(hx;λsigma)),

where the set of the inference network parameters
are λ = {λx, λmu, λsigma}.

Finally, all MLPs are implemented as below:

MLP(·) = affine(ReLU(affine( · ;λ));λ).


