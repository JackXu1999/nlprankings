



















































Hierarchical Document Encoder for Parallel Corpus Mining


Proceedings of the Fourth Conference on Machine Translation (WMT), Volume 1: Research Papers, pages 64–72
Florence, Italy, August 1-2, 2019. c©2019 Association for Computational Linguistics

64

Hierarchical Document Encoder for Parallel Corpus Mining

Mandy Guo, Yinfei Yang, Keith Stevens, Daniel Cer, Heming Ge,
Yun-Hsuan Sung, Brian Strope, Ray Kurzweil

Google AI
1600 Amphitheatre Parkway
Mountain View, CA, USA

{xyguo, yinfeiy, kstevens, cer, hemingge, yhsung, raykurzweil}@google.com

Abstract

We explore using multilingual document em-
beddings for nearest neighbor mining of par-
allel data. Three document-level representa-
tions are investigated: (i) document embed-
dings generated by simply averaging multilin-
gual sentence embeddings; (ii) a neural bag-
of-words (BoW) document encoding model;
(iii) a hierarchical multilingual document en-
coder (HiDE) that builds on our sentence-level
model. The results show document embed-
dings derived from sentence-level averaging
are surprisingly effective for clean datasets,
but suggest models trained hierarchically at
the document-level are more effective on noisy
data. Analysis experiments demonstrate our
hierarchical models are very robust to vari-
ations in the underlying sentence embedding
quality. Using document embeddings trained
with HiDE achieves state-of-the-art perfor-
mance on United Nations (UN) parallel doc-
ument mining, 94.9% P@11 for en-fr and
97.3% P@1 for en-es.

1 Introduction

Obtaining a high-quality parallel training corpus
is one of the most critical issues in machine trans-
lation. Previous work on parallel document min-
ing using large distributed systems has proven
effective (Uszkoreit et al., 2010; Antonova and
Misyurev, 2011), but these systems are often heav-
ily engineered and computationally intensive. Re-
cent work on parallel data mining has focused
on sentence-level embeddings (Guo et al., 2018;
Artetxe and Schwenk, 2018; Yang et al., 2019).
However, these sentence embedding methods have
had limited success when applied to document-
level mining tasks (Guo et al., 2018). A re-
cent study from Yang et al. (2019) shows that

1We use evaluation metrics precision at N, here P@1
means precision at 1

document embeddings obtained from averaging
sentence embeddings can achieve state-of-the-art
performance in document retrieval on the United
Nation (UN) corpus. This simple averaging ap-
proach, however, heavily relies on high quality
sentence embeddings and the cleanliness of doc-
uments in the application domain.

In our work, we explore using three variants of
document-level embeddings for parallel document
mining: (i) simple averaging of embeddings from
a multilingual sentence embedding model (Yang
et al., 2019); (ii) trained document-level embed-
dings based on document unigrams; (iii) a simple
hierarchical document encoder (HiDE) trained on
documents pairs using the output of our sentence-
level model.

The results show document embeddings are
able to achieve strong performance on parallel
document mining. On a test set mined from the
web, all models achieve strong retrieval perfor-
mance, the best being 91.4% P@1 for en-fr and
81.8% for en-es from the hierarchical document
models. On the United Nations (UN) document
mining task (Ziemski et al., 2016), our best model
achieves 96.7% P@1 for en-fr and 97.3% P@1
for en-es, a 3%+ absolute improvement over the
prior state-of-the-art (Guo et al., 2018; Uszkoreit
et al., 2010). We also evaluate on a noisier ver-
sion of the UN task where we do not have the
ground truth sentence alignments from the orig-
inal corpus. An off-the-shelf sentence splitter is
used to split the document into sentences.2 The
results shows that the HiDE model is robust to
the noisy sentence segmentations, while the aver-
aging of sentence embeddings approach is more
sensitive. We further perform analysis on the ro-
bustness of our models based on different qual-
ity sentence-level embeddings, and show that the

2To introduce noise in sentence alignment, which is often
seen in the real applications, in the parallel documents



65

HiDE model performs well even when the under-
lying sentence-level model is relatively weak.

We summarize our contributions as follows:

• We introduce and explore different ap-
proaches for using document embeddings in
parallel document mining.

• We adapt the previous work on hierarchical
networks to introduce a simple hierarchical
document encoder trained on document pairs
for this task.

• Empirical results show our best document
embedding model leads to state-of-the-art re-
sults on the document-level bitext retrieval
task on two different datasets. The proposed
hierarchical models are very robust to varia-
tions in sentence splitting and the underlying
sentence embedding quality.

2 Related Work

Parallel document mining has been extensively
studied. One standard approach is to identify
bitexts using metadata, such as document titles
(Yang and Li, 2002), publication dates (Munteanu
and Marcu, 2005, 2006), or document structure
(Chen and Nie, 2000; Resnik and Smith, 2003;
Shi et al., 2006). However, the metadata re-
lated to the documents can often be sparse or
unreliable (Uszkoreit et al., 2010). More re-
cent research has focused on embedding-based ap-
proaches, where texts are mapped to an embed-
ding space to calculate their similarity distance
and determine whether they are parallel (Grégoire
and Langlais, 2017; Hassan et al., 2018; Schwenk,
2018). Guo et al. (2018) has studied document-
level mining from sentence embeddings using a
hyperparameter tuned similarity function, but had
limited success compared to the heavily engi-
neered system proposed by Uszkoreit et al. (2010).

An extensive amount of work has also been
done on learning document embeddings. Le and
Mikolov (2014); Li et al. (2015); Dai et al. (2015)
explored Paragraph Vector with various lengths
(sentence, paragraph, document) trained on next
word/n-gram prediction given context sampled
from the paragraph. The work from Roy et al.
(2016); Chen (2017); Wu et al. (2018) obtained
document embeddings from word-level embed-
dings. More recent work has been focused on
learning document embeddings through hierarchi-
cal training. The work from Yang et al. (2016);

[x0, ..., xn] [y0, ..., ym]

Encoder Encoder

Dot Product

Figure 1: Dual encoder for parallel corpus mining,
where (x, y) represents translation pairs.

Miculicich et al. (2018) approached Document
Classification and Neural Machine Translation us-
ing Hierarchical Attention Networks, and Wang
et al. (2017) proposed using a hierarchy of Recur-
rent Neural Networks (RNNs) to summarize the
cross-sentence context. However, the amount of
work applying document embeddings to the trans-
lation pair mining task has been limited.

Yang et al. (2019) recently showed strong paral-
lel document retrieval results using document em-
beddings obtained by averaging sentence embed-
dings. Our paper extends this work to explore dif-
ferent variants of document-level embeddings for
parallel document mining, including using an end-
to-end hierarchical encoder model.

3 Model

This section introduces our document embedding
models and training procedure.

3.1 Translation Candidate Ranking Task
using a Dual Encoder

All models use the dual encoder architecture in
Figure 1, allowing candidate translation pairs to
be scored using an efficient dot-product opera-
tion. The embeddings that feed the dot-product
are trained by modeling parallel corpus mining as
a translation ranking task (Guo et al., 2018). Given
translation pair (x, y), we learn to rank true trans-
lation y over other candidates, Y . We use batch
negatives, with sentence yi of the pair (xi, yi)
serving as a random negative for all source xj in a
training batch such that j 6= i. Following Artetxe
and Schwenk (2018), a shared multilingual en-
coder is used to map both x and y to their em-
bedding space representations x′ and y′. Within a
batch, all pairwise dot-products can be computed
using a single matrix multiplication. We train us-
ing additive margin softmax (Yang et al., 2019),
subtracting a margin term m from the dot-product
scores for true translation pairs. For batch size K



66

Document
Encoder

Pooling

Dot Product

Sent
Enc

Pooling

Sent
Enc

Pooling

Sent
Enc

Pooling

DNN DNN DNN

Sentence
Encoder

Pooling Pooling

Dot Product

Sentence
Encoder

Document
Encoder

Pooling

Sentence Level Task Document Level Task

Figure 2: Illustration of the DNN→ pooling version of the Hierarchical Document Encoder (HiDE). Each sentence
is processed by our Transformer based encoding model with the final sentence-level embedding being produced
by pooling across the last layer’s positional heads. Document-level embeddings are composed by pooling across
the sentence-level embeddings after each sentence embedding has been adapted by additional feed-forward layers.

and margin m, the log-likelihood loss function is
given by Eq. 1.

J = − 1
K

K∑
i=1

log
ex

′
i·y′>i −m

ex
′
i·y′>i −m +

∑K
k=1 e

x′k,k 6=i·y
′>
k

(1)
Models are trained with a bidirectional rank-

ing objective (Yang et al., 2019). Given source
and target pair (x, y), forward translation rank-
ing, Jforward, maximizes p(y|x), while back-
ward translation ranking, Jbackward, maximizes
p(x|y). Bidirectional loss J sums the two direc-
tional losses:

J = Jforward + Jbackward (2)

3.1.1 Sentence-Level Embeddings

Sentence embeddings are produced by a Trans-
former model (Vaswani et al., 2017) with pool-
ing over the last block.3 Semantically similar hard
negatives are included to augment batch negatives
(Guo et al., 2018; Chidambaram et al., 2018; Yang
et al., 2019). We denote document embeddings
derived from averaged sentence embeddings as
Sentence-Avg.

3.1.2 Bag-of-words Document Embeddings

Our bag-of-words (BoW) document embeddings,
Document BoW, are constructed by feeding doc-
ument unigrams into a deep averaging network
(DAN) (Iyyer et al., 2015) trained on the parallel
document ranking task.4

3For pooling, we concatenate the combination of min,
max and attentional pooling.

4The model uses feed-forward hidden layers of size 320,
320, 500, and 500.

3.2 Hierarchical Document Encoder (HiDE)

As illustrated in Figure 2, our hierarchical model
is also trained on the parallel document ranking
task, but taking as input embeddings from our
sentence-level model. For HiDEDNN→pooling, sen-
tence embeddings are adapted to the document-
level task by applying a feed-forward DNN to
each sentence embedding. Average pooling ag-
gregates the adapted sentence representations into
the final fixed-length document embedding. We
contrast performance with a variant of the model,
HiDEpooling→DNN, that performs average pooling
first followed by a feed-forward DNN to adapt the
representation to document-level mining.

4 Experiments

This section describes our training data, model
configurations, and retrieval results for our em-
bedding models: Sentence-Avg, Document BoW,
HiDEDNN→pooling, and HiDEpooling→DNN.

4.1 Data

We focus on two language pairs: English-French
(en-fr) and English-Spanish (en-es). Two corpora
are used for training and evaluation.

The first corpus is obtained from web
(WebData) using a parallel document min-
ing system and automatic sentence alignments,
both following an approach similar to Uszkoreit
et al. (2010). Parallel documents number 13M for
en-fr and 6M for en-es, with 400M sentence pairs
for each language pair. We split this corpus into
training (80%), development (10%), and test set
(10%).

We also evaluate the trained models on a sec-
ond corpus, the United Nations (UN) Parallel Cor-
pus (Ziemski et al., 2016), as an out-of-domain test
set. The UN corpus contains a fully aligned sub-



67

Corpus Document Pairs
English - French

WebData

(s1) Specs Toshiba Coverside FL not categorized (4407839940), (s2) Search by brand, (s3) Icecat: syndi-
cator of product information via global Open catalog with more than 4578703 data-sheets & 19844 brands
– Register (free)

(s1) Fiche produit Toshiba Coverside FL non classé (4407839940), (s2) Partenaires en ligne, (s3) Edit my
products

Clean UN

(s1) 1 July 2011, (s2) Original: English, (s3) Tenth meeting, (s4) Cartagena, Colombia, 17 - 21 October
2011, (s5) Item 4 of the provisional agenda

(s1) 1er juillet 2011, (s2) Original : anglais, (s3) Dixième réunion, (s4) Cartagena (Colombie), 17-21
octobre 2011, (s5) Point 4 de l’ordre du jour provisoire*

Noisy UN

(s1) 6–7 May 1999 Non-governmental organizations New York, 14 to 18 December 1998 Corrigendum 1.,
(s2) Paragraph 1, draft decision I, under “Special consultative status” 2., (s3) Paragraph 48 Add Japan to
the list of States Members of the United Nations represented by observers.

(s1) 6 et 7 mai 1999 Organisations non gouvernementales New York, 14-18 décembre 1998 Rectificatif
Paragraphe 1, projet de décision I, sous la rubrique “Statut consultatif spécial” Paragraphe 48 Ajouter le
Japon à la liste des États Membres de l’Organisation des Nations Unies représentés par des observateurs.

English - Spanish

WebData

(s1) Alcudia travel Guide & Map - android apps on Google play, (s2) Travel & Local, (s3) Alcudia travel
Guide & Map, (s4) Maps, GPS Navigation Travel & Local, (s5) Offers in-app purchases”

(s1) Beirut Travel Guide & map - aplicaciones Android en Google play, (s2) Todavı́a más ”, (s3) Seleccin
de los editores, (s4) Libros de texto, (s5) Comprar tarjeta de regalo

Clean UN

(s1) [Original: English], (s2) Monthly report to the United Nations on the operations of the Kosovo Force,
(s3) 1. Over the reporting period (1-28 February 2003) there were just over 26,600 troops of the Kosovo
Force (KFOR) in theatre.

(s1) [Original: inglés], (s2) Informe mensual de las Naciones Unidas sobre las operaciones de la Fuerza
Internacional de Seguridad en Kosovo, (s3) En el perı́odo sobre el que se informa (1 a 28 de febrero 2003)
habı́a en el teatro de operaciones algo más de 26.600 efectivos de la Fuerza Internacional de Seguridad en
Kosovo (KFOR).

Noisy UN

(s1) (Original: English) Monthly report to the United Nations on the operations of the Kosovo Force 1.,
(s2) Over the reporting period (1-28 February 2003) there were just over 26,600 troops of the Kosovo Force
(KFOR) in theatre.

(s1) (Original: inglés) Informe mensual de las Naciones Unidas sobre las operaciones de la Fuerza Inter-
nacional de Seguridad en Kosovo En el perı́odo sobre el que se informa (1 a 28 de febrero 2003) habı́a en
el teatro de operaciones algo más de 26.600 efectivos de la Fuerza Internacional de Seguridad en Kosovo
(KFOR).

Table 1: Example document snippets from the WebData, original UN corpus, UN corpus with noisy sentence
segmentation. We only show the starting sentences for each document, the original documents can go very long.
Symbol (sn) means sentence n in the document to show sentence segmentation.

corpus of ∼86k document pairs for the six official
UN languages.5 As this corpus is small, it is only
used for evaluation.

The sentence segmentation in the fully aligned
subcorpus is particularly good due to the process
used to construct the dataset. While automatic
sentence splitting is performed using the Eserix
spltter, documents are only included in the fully
aligned subcorpus if sentences are consistently
aligned across all six languages. This implicitly
filters documents with noisy sentence segmenta-
tions. Exceptions are errors in the sentence seg-
mentation that are systematically replicated across
the documents in all six languages.

5Arabic, Chinese, English, French, Russian, and Spanish.

We create a noisier version of the UN dataset
that makes use of an robust off-the-shelf sentence
splitter, but which necessarily introduces noise
compare to sentences that were split by consen-
sus across all six languages within the original UN
dataset. Models are evaluated on this noisy UN
corpus, as any real application of our models will
almost certainly need to contend with noisy auto-
matic sentence splits.

Table 1 shows examples from each dataset. The
WebData dataset is very noisy and contains a
large amount of template-like queries from web.
In this dataset, sentence alignments can be also
very noisy, and sometimes sentences are not di-
rect translations of each other. The original UN



68

is translated sentence by sentence by human anno-
tators, so it is perfectly aligned at the sentence-
level with ground truth translations. The noisy
UN, however, could have incorrect sentence-level
mappings, but these could still be correct transla-
tions on the document-level. The sentence split-
ter used to generate the noisy UN dataset could
also perform differently in different languages for
the parallel content, resulting in mismatches at the
sentence-level. As seen in the Noisy UN exam-
ples shown in Table 1, the English text is split
into 3 sentences, while the corresponding French
or Spanish texts are only split into 1 sentence.

4.2 Configuration
Our sentence-level encoder follows a similar setup
as Yang et al. (2019). The sentence encoder
has a shared 200k token multilingual vocabulary
with 10K OOV buckets. Vocabulary items and
OOV buckets map to 320 dim. word embeddings.
For each token, we also extract character n-grams
(n = [3, 6]) hashed to 200k buckets mapped to 320
dim. character embeddings. Word and character n-
gram representations are summed together to pro-
duce the final input token representation. Updates
to the word and character embeddings are scaled
by a gradient multiplier of 25 (Chidambaram et al.,
2018). The encoder uses 3 transformer blocks
with hidden size of 512, filter size of 2048, and
8 attention heads. Additive margin softmax uses
m = 0.3. We train for 40M steps for both lan-
guage pairs using an SGD optimizer with batch
size K=100 and learning rate 0.003.

During document-level training, sentence em-
beddings are fixed due to the computational cost
of dynamically encoding all of the sentences in a
document. Sentence embeddings are adapted us-
ing a four-layer DNN model with residual connec-
tions and hidden sizes 320, 320, 500, and 500.
The first three layers use ReLU activations with
the final layer using Tanh. Document embed-
dings are trained with an SGD optimizer, batch
size K = 200, learning rate 0.0001, and additive
margin softmax m = 0.5 for en-fr, and m = 0.6
for en-es. We train for 5M steps for en-fr and 2M
steps for en-es. Light hyperparameter tuning uses
our development set from WebData.

4.3 Mining Translations and Evaluation
Translation candidates are mined with approxi-
mate nearest neighbor (ANN) (Vanderkam et al.,
2013) search over our multilingual embed-

dings (Guo et al., 2018; Artetxe and Schwenk,
2018).6 The evaluation metric is precision at N
(P@N), which evaluates if the true translation is
in the top N candidates returned by the model.

4.3.1 Results on WebData Test Set
Table 2 presents document embedding P@N re-
trieval performance using our WebData test set,
for N = 1, 3, 10. The evaluation uses 1M candi-
date documents for en-fr and 0.6M for en-es. We
obtain the best performance from our hierarchical
models, HiDE∗. Adapting the sentence embed-
dings prior to pooling, HiDEDNN→pooling performs
better than attempting to adapt the representation
after pooling, HiDEpooling→DNN. Document BoW
embeddings outperform Sentence-Avg, showing
training a simple model for document-level repre-
sentations (DAN) outperforms pooling of sentence
embeddings from a complex model (Transformer).

4.3.2 Results on UN Corpus
Table 3 shows document matching P@1 for our
models on both the original UN dataset sentence
segmentation and on the noisier sentence segmen-
tation. P@1 is evaluated using all of the UN doc-
uments in a target language as translation can-
didates. The prior state-of-the-art is Uszkoreit
et al. (2010).7 Using both the official and noisy
sentence segmentations, HiDEDNN→pooling outper-
forms Uszkoreit et al. (2010), a heavily engineered
system that incorporates both MT and monolin-
gual duplicated document detection.

Guo et al. (2018) uses sentence-to-sentence
alignments to heuristically identify document
pairs. Alignments were computed using sentence
embeddings generated over the UN corpus an-
notated sentence splits. With corpus annotated
splits, Sentence-Avg performs better than Guo
et al. (2018). Furthermore, even with noisy sen-
tence splits HiDE∗ outperforms Guo et al. (2018).

The performance of all our document embed-
dings methods that build on sentence-level repre-
sentations is remarkably strong when we use the
sentence boundaries annotated in the UN corpus.
Surprisingly, Sentence-Avg performed poorly on
the WebData test data but is very competitive with
both variants of HiDE when using the original
UN corpus sentence splits.8 However, on the UN

6Prior work only used ANN over sentence embeddings.
7Uszkoreit et al. (2010) was applied to the UN dataset by

Guo et al. (2018).
8We use similar sentence-level encoder setup as Yang



69

Document Embedding
en-fr (1M) en-es (0.6M)

P@1 P@3 P@10 P@1 P@3 P@10
HiDEDNN→pooling 91.40 94.13 95.67 81.83 87.85 91.45
HiDEpooling→DNN 90.63 93.50 95.11 78.84 85.04 88.88
Document BoW 83.83 90.47 94.18 78.09 85.04 91.03
Sentence-Avg 78.07 83.53 87.06 67.49 74.22 79.01

Table 2: Precision at N (P@N) of target document retrieval on the WebData test set. Models attempt to select the
true translation target for a source document from the entire corpus (1 million parallel documents for en-fr, and 0.6
million for en-es).

Model en-fr en-es
UN Corpus Sentence Segmentation

HiDEDNN→pooling 96.6 97.3
HiDEpooling→DNN 96.5 96.1
Sentence-Avg 96.7 97.3

Noisy Sentence Segmentation
HiDEDNN→pooling 94.9 96.0
HiDEpooling→DNN 91.0 94.4
Sentence-Avg 86.8 95.7

No sentence splitting
Document BoW 74.3 71.9

Prior work
Uszkoreit et al. (2010) 93.4 94.4
Guo et al. (2018) 89.0 90.4

Table 3: Document matching on the UN corpus eval-
uated using P@1. For methods that require sentence
splitting, we report results using both the UN sentence
annotations and an off-the-shelf sentence splitter.

data with noisy sentence splits, HiDE∗ once again
significantly outperforms Sentence-Avg. Averag-
ing sentence embeddings appears to be a strong
baseline for clean datasets, but the hierarchical
model helps when composing document embed-
dings from noisier input representations.9 Simi-
lar to the WebData test set, on the noisy UN data,
HiDEDNN→pooling outperforms HiDEpooling→DNN.
We note that while Document BoW performed
well on the in-domain test set, it performs poorly
on the UN data. Preliminary analysis suggests this
is due in part to differences in length between the
WebData and UN documents.

We also observe that the performance of
Sentence-Avg model dropped significantly in en-
fr when transitioning from the Clean UN to the
Noisy UN, but in en-es, the performance drop is

et al. (2019), we are able to obtain matching results on the
original UN corpus

9We note that in practice parallel document mining will
tend to operate over noisy datasets.

Figure 3: Histogram of document length differences
w.r.t. # of sentences in each parallel document pair.

much less. We compute the histogram of the doc-
ument length differences in each document pair
w.r.t. the # of sentences in each document on
the noisy UN corpus. As shown in figure 3, the
en-es dataset indeed has better agreement on the
sentence split comparing with en-fr, which indi-
cates the Sentence-Avg model is sensitive to the
sentence segmentation quality of the parallel doc-
ument pairs.

5 Analysis

In this section, we first analyze the errors produced
by the document embedding models. We then ex-
plore how the performance of sentence-level mod-
els affect the performance of document-level mod-
els that incorporate sentence-embeddings.

5.1 Errors

We first look at the false positive examples re-
trieved by HiDEDNN→pooling model on en-es Web-
Doc development set. We observe that the actual
error results often have similar sentence structure
and meaning comparing to the expected result.

Table 4 list two typical example snippets for



70

Example 1

Source Audio-technica mb 3k b-stock - Thomann ireland, Dynamic Microphones finder, 40 e– 60, 60 e– 100, 100
e– 120, 120 e– 160, 160 e– 200, 200 e– 280, 280 e– 460, in stock items

Expected Result
Beyerdynamic tg-x58 b-stock - Thomann españa, Micrófonos dinámicos de voz encontrar ..., Gama de
precios, 40 e– 60, 60 e– 100, 100 e– 120, 120 e– 160, 160 e– 200, 200 e– 280, 280 e– 460, Reajustar
todos los filtros

Actual Result
Audio-technica atm63 u - Thomann españa, Micrófonos dinámicos de voz encontrar ..., Gama de precios,
40 e– 60, 60 e– 100, 100 e– 120, 120 e– 160, 160 e– 200, 200 e– 280, 280 e– 400, Reajustar todos los
filtros

Example 2

Source
Casual man suit photo - android apps on google play, Casual man suit photo, Casual shirt Photo suit is
photography application to make your face in nice fashionable man suit., This is so easy and free to make
your photo into nice looking suit without any hard work and it’s all free.

Expected Result
Casual fotos - aplicaciones de android en Google play, Todavı́a más ”, Selección de nuestros expertos, Libros
de texto, Comprar tarjeta regalo, Mi lista de deseos, Mi actividad de Play, Guı́a para padres, Arte y Diseño,
Bibliotecas y demos, Casa y hogar

Actual Result
Traje de la foto de la camisa formal de los hombre - aplicaciones de android en Google play, Todavı́a más ”,
Selección de nuestros expertos, Libros de texto, Comprar tarjeta regalo, Mi lista de deseos, Mi actividad de
Play, Guı́a para padres, Arte y Diseño, Bibliotecas y demos, Casa y hogar

Table 4: Example document snippets of source, expected result, and actual result retrieved by HiDEDNN→pooling
model on the en-es development sets.

HiDEDNN→pooling. In the first example, our model
matches the translation of ”Audio-technica” to
”Audio-technica” instead of ”Beyerdynamic”. We
observe that in multiple cases, HiDE model is able
to retrieve a more accurate translation pair than
the labeled expected result. As shown in Table 1,
the WebData automatically mined from the web
is noisy and may contains non-translation pairs.
This results indicates the proposed model is robust
to the training data noise. The second example
shows another typical error where the documents
are template-like. The actual results retrieved by
HiDEDNN→pooling still largely match the expected
text.

We also look at the actual results retrieved
from Sentence-Avg model. The Sentence-Avg
model also suffers from the template-like docu-
ments (e.g. Example 2 in Table 4) similar to the
HiDEDNN→pooling model. Other than that, though
some correctly translated words can be found, the
retrieved error documents differ much more in
sentence structure and meaning from the expected
results. For example, the expected and actual re-
sults can both be documents about the same sub-
ject, but from entirely different perspectives. We
also found that some of the WebData target docu-
ments are in English instead of Spanish. In these
cases, the Sentence-Avg model is more likely to
retrieve a document in the same language as the
source document instead of retrieving a translated
document.

5.2 HiDE performance on Coarse
Sentence-level Models

We further explore how the performance of
sentence-level models affect the performance of
document-level models that incorporate sentence-
embeddings. We use different encoder configura-
tions to produce sentence embeddings of varying
quality as expressed by P@1 results for sentence-
level retrieval on the UN dataset.10 Table 5 shows
the P@1 of target document retrieval on both the
WebData test set and the noisy UN corpus for
HiDEDNN→pooling and Sentence-Avg. While sen-
tence encoding quality does impact document-
level performance, the HiDE model is surprisingly
robust once the sentence encoder reaches around
66% P@1, whereas the Sentence-Avg model re-
quires much higher quality sentence-level embed-
dings (around 85% for en-fr, and 80% for en-es).
The robustness of HiDE model provides a means
for obtaining high-quality document embeddings
without high-quality sentence embeddings, and
thus provides the option to trade-off sentence-level
embedding quality for speed and memory perfor-
mance.

6 Conclusion

In this paper, we explore parallel document min-
ing using several document embedding methods.

10Model sentence-level model performance was varied by
generating models with hyperparameters selected to degrade
performance (e.g., fewer training sets, no margin softmax).



71

Languages P@1 at Sentence Level
P@1 on WebDoc test P@1 on Noisy UN

HiDEDNN→pooling Sentence-Avg HiDEDNN→pooling Sentence-Avg

en-fr

48.9 66.6 0.6 70.3 4.4
66.9 89.2 54.3 92.6 63.9
81.3 90.5 72.9 92.1 76.9
86.1 91.3 78.1 94.9 86.9

en-es

54.9 59.0 1.2 81.3 4.7
67.0 79.1 54.2 93.2 82.9
80.6 79.8 60.1 91.2 88.9
89.0 81.9 67.4 96.0 95.7

Table 5: P@1 of target document retrieval on WebData test set and noisy UN corpus for HiDEDNN→pooling and
Sentence-Avg models with different sentence-level P@1 performance . The sentence-level peroformance is mea-
sured on the sentence-level UN retrieval task from the entire corpus (11.3 million sentence candidates).

Mining using document embeddings achieves a
new state-of-the-art perfomance on the UN par-
allel document mining task (en-fr, en-es). Docu-
ment embeddings computed by simply averaging
sentence embeddings provide a very strong base-
line for clean datasets, while hierarchical embed-
ding models perform best on noisier data. Finally,
we show document embeddings based on aggrega-
tions of sentence embeddings are surprisingly ro-
bust to variations in sentence embedding quality,
particularly for our hierarchical models.

Acknowledgements

We are grateful to the anonymous reviewers and
our teammates in Deacartes and Google Translate
for their valuable discussions, especially Chris Tar,
Gustavo Adolfo Hernandez Abrego, and Wolf-
gang Macherey.

References
Alexandra Antonova and Alexey Misyurev. 2011.

Building a web-based parallel corpus and filtering
out machine-translated text. In Proceedings of the
4th Workshop on Building and Using Comparable
Corpora: Comparable Corpora and the Web, pages
136–144. Association for Computational Linguis-
tics.

Mikel Artetxe and Holger Schwenk. 2018. Margin-
based parallel corpus mining with multilingual sen-
tence embeddings. CoRR, abs/1811.01136.

Jiang Chen and Jian-Yun Nie. 2000. Parallel web
text mining for cross-language ir. In Content-
Based Multimedia Information Access-Volume 1,
pages 62–77. Centre de Hautes Etudes Interna-
tionale D’Informatique Documentaire.

Minmin Chen. 2017. Efficient vector representation
for documents through corruption. 5th International
Conference on Learning Representations.

Muthuraman Chidambaram, Yinfei Yang, Daniel Cer,
Steve Yuan, Yun-Hsuan Sung, Brian Strope, and Ray
Kurzweil. 2018. Learning cross-lingual sentence
representations via a multi-task dual-encoder model.
CoRR, abs/1810.12836.

Andrew M. Dai, Christopher Olah, and Quoc V. Le.
2015. Document embedding with paragraph vec-
tors. CoRR, abs/1507.07998.

Francis Grégoire and Philippe Langlais. 2017. A deep
neural network approach to parallel sentence extrac-
tion. arXiv preprint arXiv:1709.09783.

Mandy Guo, Qinlan Shen, Yinfei Yang, Heming
Ge, Daniel Cer, Gustavo Hernandez Abrego, Keith
Stevens, Noah Constant, Yun-hsuan Sung, Brian
Strope, and Ray Kurzweil. 2018. Effective parallel
corpus mining using bilingual sentence embeddings.
In Proceedings of the Third Conference on Machine
Translation: Research Papers, pages 165–176. As-
sociation for Computational Linguistics.

Hany Hassan, Anthony Aue, Chang Chen, Vishal
Chowdhary, Jonathan Clark, Christian Feder-
mann, Xuedong Huang, Marcin Junczys-Dowmunt,
William Lewis, Mu Li, et al. 2018. Achieving hu-
man parity on automatic chinese to english news
translation. arXiv preprint arXiv:1803.05567.

Mohit Iyyer, Varun Manjunatha, Jordan Boyd-Graber,
and Hal Daumé III. 2015. Deep unordered compo-
sition rivals syntactic methods for text classification.
In Proceedings of the 53rd Annual Meeting of the
Association for Computational Linguistics and the
7th International Joint Conference on Natural Lan-
guage Processing (Volume 1: Long Papers), pages
1681–1691, Beijing, China. Association for Com-
putational Linguistics.

Quoc Le and Tomas Mikolov. 2014. Distributed repre-
sentations of sentences and documents. In Proceed-
ings of the 31st International Conference on Inter-
national Conference on Machine Learning - Volume
32, ICML’14, pages II–1188–II–1196. JMLR.org.

Bofang Li, Tao Liu, Xiaoyong Du, Deyuan Zhang, and
Zhe Zhao. 2015. Learning document embeddings

http://arxiv.org/abs/1811.01136
http://arxiv.org/abs/1811.01136
http://arxiv.org/abs/1811.01136
http://arxiv.org/abs/1810.12836
http://arxiv.org/abs/1810.12836
http://arxiv.org/abs/1507.07998
http://arxiv.org/abs/1507.07998
http://aclweb.org/anthology/W18-6317
http://aclweb.org/anthology/W18-6317
http://www.aclweb.org/anthology/P15-1162
http://www.aclweb.org/anthology/P15-1162
http://dl.acm.org/citation.cfm?id=3044805.3045025
http://dl.acm.org/citation.cfm?id=3044805.3045025
http://arxiv.org/abs/1512.08183


72

by predicting n-grams for sentiment classification of
long movie reviews. CoRR, abs/1512.08183.

Lesly Miculicich, Dhananjay Ram, Nikolaos Pappas,
and James Henderson. 2018. Document-level neural
machine translation with hierarchical attention net-
works. In Proceedings of the 2018 Conference on
Empirical Methods in Natural Language Process-
ing, pages 2947–2954, Brussels, Belgium. Associ-
ation for Computational Linguistics.

Dragos Stefan Munteanu and Daniel Marcu. 2005. Im-
proving machine translation performance by exploit-
ing non-parallel corpora. Computational Linguis-
tics, 31(4):477–504.

Dragos Stefan Munteanu and Daniel Marcu. 2006. Ex-
tracting parallel sub-sentential fragments from non-
parallel corpora. In Proceedings of the 21st Interna-
tional Conference on Computational Linguistics and
the 44th Annual Meeting of the Association for Com-
putational Linguistics, pages 81–88. Association for
Computational Linguistics.

Philip Resnik and Noah A. Smith. 2003. The web as a
parallel corpus. Comput. Linguist., 29(3):349–380.

Dwaipayan Roy, Debasis Ganguly, Mandar Mitra, and
Gareth J. F. Jones. 2016. Representing documents
and queries as sets of word embedded vectors for
information retrieval. CoRR, abs/1606.07869.

Holger Schwenk. 2018. Filtering and mining paral-
lel data in a joint multilingual space. In Proceed-
ings of the 56th Annual Meeting of the Association
for Computational Linguistics (Volume 2: Short Pa-
pers), pages 228–234, Melbourne, Australia. Asso-
ciation for Computational Linguistics.

Lei Shi, Cheng Niu, Ming Zhou, and Jianfeng Gao.
2006. A dom tree alignment model for mining paral-
lel data from the web. In Proceedings of the 21st In-
ternational Conference on Computational Linguis-
tics and the 44th Annual Meeting of the Association
for Computational Linguistics, pages 489–496. As-
sociation for Computational Linguistics.

Jakob Uszkoreit, Jay M. Ponte, Ashok C. Popat, and
Moshe Dubiner. 2010. Large scale parallel docu-
ment mining for machine translation. In Proceed-
ings of the 23rd International Conference on Com-
putational Linguistics, COLING ’10, pages 1101–
1109, Stroudsburg, PA, USA. Association for Com-
putational Linguistics.

Dan Vanderkam, Rob Schonberger, Henry Rowley, and
Sanjiv Kumar. 2013. Nearest neighbor search in
google correlate. Technical report, Google.

Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob
Uszkoreit, Llion Jones, Aidan N Gomez, Ł ukasz
Kaiser, and Illia Polosukhin. 2017. Attention is all
you need. In I. Guyon, U. V. Luxburg, S. Bengio,
H. Wallach, R. Fergus, S. Vishwanathan, and R. Gar-
nett, editors, Advances in Neural Information Pro-
cessing Systems 30, pages 5998–6008. Curran As-
sociates, Inc.

Longyue Wang, Zhaopeng Tu, Andy Way, and Qun
Liu. 2017. Exploiting cross-sentence context for
neural machine translation. In Proceedings of the
2017 Conference on Empirical Methods in Natu-
ral Language Processing, pages 2826–2831, Copen-
hagen, Denmark. Association for Computational
Linguistics.

Lingfei Wu, Ian En-Hsu Yen, Kun Xu, Fangli
Xu, Avinash Balakrishnan, Pin-Yu Chen, Pradeep
Ravikumar, and Michael J. Witbrock. 2018. Word
mover’s embedding: From word2vec to document
embedding. In Proceedings of the 2018 Conference
on Empirical Methods in Natural Language Pro-
cessing, pages 4524–4534. Association for Compu-
tational Linguistics.

Christopher C Yang and Kar Wing Li. 2002. Mining
english/chinese parallel documents from the world
wide web. In Proceedings of the 11th International
World Wide Web Conference, Honolulu, USA.

Yinfei Yang, Gustavo Hernández Ábrego, Steve Yuan,
Mandy Guo, Qinlan Shen, Daniel Cer, Yun-Hsuan
Sung, Brian Strope, and Ray Kurzweil. 2019. Im-
proving multilingual sentence embedding using bi-
directional dual encoder with additive margin soft-
max. CoRR, abs/1902.08564.

Zichao Yang, Diyi Yang, Chris Dyer, Xiaodong He,
Alex Smola, and Eduard Hovy. 2016. Hierarchi-
cal attention networks for document classification.
In Proceedings of the 2016 Conference of the North
American Chapter of the Association for Computa-
tional Linguistics: Human Language Technologies,
pages 1480–1489, San Diego, California. Associa-
tion for Computational Linguistics.

Michal Ziemski, Marcin Junczys-Dowmunt, and Bruno
Pouliquen. 2016. The united nations parallel cor-
pus v1. 0. In Proceedings of the Tenth International
Conference on Language Resources and Evaluation,
LREC ’16. European Language Resources Associa-
tion.

http://arxiv.org/abs/1512.08183
http://arxiv.org/abs/1512.08183
https://www.aclweb.org/anthology/D18-1325
https://www.aclweb.org/anthology/D18-1325
https://www.aclweb.org/anthology/D18-1325
https://doi.org/10.1162/089120103322711578
https://doi.org/10.1162/089120103322711578
http://arxiv.org/abs/1606.07869
http://arxiv.org/abs/1606.07869
http://arxiv.org/abs/1606.07869
https://www.aclweb.org/anthology/P18-2037
https://www.aclweb.org/anthology/P18-2037
http://dl.acm.org/citation.cfm?id=1873781.1873905
http://dl.acm.org/citation.cfm?id=1873781.1873905
http://www.google.com/trends/correlate/nnsearch.pdf
http://www.google.com/trends/correlate/nnsearch.pdf
http://papers.nips.cc/paper/7181-attention-is-all-you-need.pdf
http://papers.nips.cc/paper/7181-attention-is-all-you-need.pdf
https://doi.org/10.18653/v1/D17-1301
https://doi.org/10.18653/v1/D17-1301
http://aclweb.org/anthology/D18-1482
http://aclweb.org/anthology/D18-1482
http://aclweb.org/anthology/D18-1482
http://arxiv.org/abs/1902.08564
http://arxiv.org/abs/1902.08564
http://arxiv.org/abs/1902.08564
http://arxiv.org/abs/1902.08564
https://doi.org/10.18653/v1/N16-1174
https://doi.org/10.18653/v1/N16-1174

